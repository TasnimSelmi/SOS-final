<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hack for Hope - SOS Villages d'Enfants</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* SOS Official Brand Colors - Enhanced */
            --sos-blue: #00abec;
            --sos-dark-blue: #1c325d;
            --sos-light-blue: #e8f7fc;
            --sos-pink: #de5a6c;
            --sos-pink-light: #f5a5ae;
            --sos-white: #FFFFFF;
            --sos-cream: #F5FAFC;
            --sos-logo-bg: #4A6FA5;
            
            /* Enhanced Gradients */
            --gradient-primary: linear-gradient(135deg, #00abec 0%, #1c325d 100%);
            --gradient-pink: linear-gradient(135deg, #de5a6c 0%, #f5a5ae 100%);
            --gradient-hero: linear-gradient(135deg, rgba(0, 171, 236, 0.1) 0%, rgba(222, 90, 108, 0.05) 100%);
            --gradient-card: linear-gradient(180deg, #ffffff 0%, #f8fdff 100%);
            
            /* Text Colors */
            --text-primary: #1c325d;
            --text-secondary: #4A6B82;
            --text-muted: #7B97AC;
            
            /* Functional */
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            
            /* Enhanced Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 171, 236, 0.08);
            --shadow-md: 0 4px 20px rgba(0, 171, 236, 0.12);
            --shadow-lg: 0 8px 40px rgba(0, 171, 236, 0.15);
            --shadow-xl: 0 20px 60px rgba(28, 50, 93, 0.15);
            --shadow-hover: 0 12px 32px rgba(0, 171, 236, 0.2);
            
            /* Animation Timing */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--sos-white) 0%, var(--sos-light-blue) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ========================================
           ENHANCED ANIMATIONS & EFFECTS
           ======================================== */
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease forwards;
        }

        .animate-fadeIn {
            animation: fadeIn 0.4s ease forwards;
        }

        .animate-slideIn {
            animation: slideIn 0.4s ease forwards;
        }

        /* ========================================
           ENHANCED DESIGN SYSTEM
           ======================================== */

        /* SOS Logo - Enhanced */
        .sos-logo {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0, 171, 236, 0.3);
            transition: var(--transition-base);
        }

        .sos-logo:hover {
            transform: scale(1.05) rotate(3deg);
            box-shadow: 0 6px 20px rgba(0, 171, 236, 0.4);
        }

        .sos-logo svg {
            width: 44px;
            height: 44px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        /* Enhanced SOS Slogan */
        .sos-slogan {
            display: flex;
            align-items: baseline;
            gap: 0.3rem;
            font-size: 0.7rem;
            margin-top: 0.15rem;
            font-weight: 500;
        }

        .sos-slogan .we-can,
        .sos-slogan .we-do,
        .sos-slogan .with-text {
            color: var(--sos-blue);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .sos-slogan .love-text {
            font-family: 'Brush Script MT', 'Segoe Script', cursive;
            color: var(--sos-pink);
            font-size: 0.95rem;
            font-weight: normal;
            text-shadow: 0 2px 4px rgba(222, 90, 108, 0.2);
        }

        /* Enhanced Decorative Elements */
        .deco-bubble {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            opacity: 0.08;
            animation: float 6s ease-in-out infinite;
        }

        .bubble-1 {
            width: 400px;
            height: 350px;
            background: var(--gradient-primary);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            top: -100px;
            right: -100px;
            transform: rotate(-15deg);
            animation-delay: 0s;
        }

        .bubble-2 {
            width: 250px;
            height: 220px;
            background: var(--gradient-pink);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            bottom: 5%;
            left: -80px;
            transform: rotate(20deg);
            opacity: 0.06;
            animation-delay: 2s;
        }

        .bubble-3 {
            width: 180px;
            height: 180px;
            background: var(--sos-blue);
            border-radius: 50%;
            top: 40%;
            right: 10%;
            opacity: 0.04;
            animation-delay: 4s;
        }

        .deco-j {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            opacity: 0.06;
        }

        .j-shape {
            width: 200px;
            height: 350px;
            background: var(--gradient-primary);
            border-radius: 0 0 100px 0;
            top: 10%;
            right: 2%;
            transform: rotate(-5deg);
        }

        /* Enhanced Header */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 4px solid var(--sos-pink);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
        }

        .main-header.scrolled {
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-text h1 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--sos-dark-blue);
            letter-spacing: -0.02em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-text p {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        /* Enhanced Landing Page */
        .landing-screen {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
            position: relative;
            z-index: 1;
            background: var(--gradient-hero);
        }

        .landing-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 4px solid var(--sos-pink);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        .landing-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
        }

        .landing-hero {
            text-align: center;
            max-width: 700px;
            padding: 3rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            box-shadow: var(--shadow-xl);
            animation: fadeInUp 0.8s ease forwards;
        }

        .landing-hero h1 {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        .landing-hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            line-height: 1.7;
            font-weight: 400;
        }

        .landing-hero .btn-primary {
            max-width: 350px;
            font-size: 1.2rem;
            padding: 1.25rem 3rem;
            background: var(--gradient-primary);
            box-shadow: 0 4px 15px rgba(0, 171, 236, 0.4);
            animation: pulse 2s infinite;
        }

        .landing-hero .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 171, 236, 0.5);
            animation: none;
        }

        /* Profile Styles */
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--sos-blue);
            cursor: pointer;
        }

        .profile-avatar-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--sos-light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid var(--sos-blue);
            cursor: pointer;
        }

        .profile-card .avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--sos-blue);
            margin-bottom: 1rem;
        }

        .profile-card .avatar-placeholder-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--sos-light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 4px solid var(--sos-blue);
            margin-bottom: 1rem;
        }

        .avatar-upload-zone {
            border: 2px dashed var(--sos-blue);
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--sos-light-blue);
            margin: 0 auto 1rem;
        }

        .avatar-upload-zone:hover {
            border-color: var(--sos-pink);
            background: rgba(222, 90, 108, 0.05);
        }

        .avatar-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .avatar-actions button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            width: auto;
        }

        /* Profile Modal */
        .profile-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .profile-modal-overlay.active {
            display: flex;
        }

        .profile-modal {
            background: var(--sos-white);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .profile-modal h2 {
            color: var(--sos-dark-blue);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .profile-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--sos-light-blue);
        }

        .profile-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .profile-section h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Enhanced Login Screen */
        .login-screen {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
            z-index: 1;
            background: var(--gradient-hero);
        }

        .login-container {
            background: var(--sos-white);
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 520px;
            overflow: hidden;
            position: relative;
            z-index: 2;
            animation: fadeInUp 0.6s ease forwards;
        }

        .login-header {
            background: var(--gradient-primary);
            padding: 2.5rem 2rem;
            text-align: center;
            border-bottom: 4px solid var(--sos-pink);
        }

        .login-logo {
            width: 90px;
            height: 90px;
            margin: 0 auto 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: pulse 3s infinite;
        }

        .login-logo svg {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }

        .login-header h1 {
            color: var(--sos-white);
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .login-header .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .login-body {
            padding: 2rem;
            background: var(--sos-white);
        }

        /* Enhanced Role Cards */
        .role-selection {
            margin-bottom: 2rem;
        }

        .role-selection h3 {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 1.25rem;
            font-weight: 700;
            text-align: center;
        }

        .role-cards {
            display: grid;
            gap: 0.875rem;
        }

        .role-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            border: 2px solid var(--sos-light-blue);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--gradient-card);
            position: relative;
            overflow: hidden;
        }

        .role-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 171, 236, 0.05), transparent);
            transition: left 0.5s;
        }

        .role-card:hover::before {
            left: 100%;
        }

        .role-card:hover {
            border-color: var(--sos-blue);
            background: var(--sos-light-blue);
            transform: translateX(8px);
            box-shadow: var(--shadow-md);
        }

        .role-card.active {
            border-color: var(--sos-blue);
            background: var(--sos-light-blue);
            box-shadow: var(--shadow-md);
            transform: translateX(8px);
        }

        .role-card.active .role-icon {
            background: var(--gradient-primary);
            color: white;
        }

        .role-icon {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            background: var(--sos-light-blue);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .role-card:hover .role-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .role-info h4 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .role-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
            margin-bottom: 0.625rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--sos-light-blue);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--sos-white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--sos-blue);
            box-shadow: 0 0 0 4px rgba(0, 171, 236, 0.1), 0 4px 12px rgba(0, 171, 236, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        /* Enhanced Buttons */
        .btn {
            width: 100%;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--sos-white);
            box-shadow: 0 4px 15px rgba(0, 171, 236, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 171, 236, 0.4);
        }

        .btn-secondary {
            background: var(--sos-white);
            color: var(--sos-blue);
            border: 2px solid var(--sos-blue);
            width: auto;
        }

        .btn-secondary:hover {
            background: var(--sos-light-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        /* Enhanced Cards */
        .card {
            background: var(--gradient-card);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 171, 236, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        /* Enhanced Navigation Buttons */
        .nav-btn {
            padding: 0.875rem 1.75rem;
            border: 2px solid var(--sos-light-blue);
            background: var(--sos-white);
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover, .nav-btn.active {
            border-color: var(--sos-blue);
            background: var(--sos-blue);
            color: var(--sos-white);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 171, 236, 0.3);
        }

        .card-header {
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--sos-dark-blue);
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-select, .form-textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--sos-light-blue);
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            background: var(--sos-white);
            color: var(--text-primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--sos-blue);
        }

        .required::after {
            content: ' *';
            color: var(--sos-pink);
        }

        .upload-zone {
            border: 2px dashed var(--sos-blue);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            background: var(--sos-light-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            border-color: var(--sos-pink);
            background: rgba(222, 90, 108, 0.05);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-secondary {
            background: var(--sos-white);
            color: var(--sos-blue);
            border: 2px solid var(--sos-blue);
            width: auto;
        }

        .btn-secondary:hover {
            background: var(--sos-light-blue);
        }

        .table-container {
            background: var(--sos-white);
            border-radius: 16px;
            overflow: hidden;
        }

        .badge {
            padding: 0.4rem 0.875rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-en-traitement {
            background: rgba(0, 171, 236, 0.15);
            color: var(--sos-blue);
        }

        .badge-cl√¥tur√© {
            background: rgba(78, 205, 196, 0.15);
            color: var(--success);
        }

        .badge-urgent {
            background: rgba(222, 90, 108, 0.15);
            color: var(--sos-pink);
        }

        /* Enhanced Stats Cards */
        .stat-card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 1.75rem;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 171, 236, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card.info::before { background: var(--gradient-primary); }
        .stat-card.urgent::before { background: var(--gradient-pink); }
        .stat-card.success::before { background: linear-gradient(90deg, #10b981, #34d399); }
        .stat-card.warning::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Workflow */
        .workflow-container {
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .workflow-steps {
            display: flex;
            gap: 1rem;
            min-width: max-content;
        }

        .step-card {
            background: var(--sos-white);
            border-radius: 16px;
            padding: 1.25rem;
            min-width: 200px;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .step-card::after {
            content: '‚Üí';
            position: absolute;
            right: -0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.25rem;
            color: var(--sos-blue);
        }

        .step-card:last-child::after {
            display: none;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--sos-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .step-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .step-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Priority indicators */
        .priority-√©lev√©e {
            color: var(--sos-pink);
            font-weight: 600;
        }

        .priority-moyenne {
            color: var(--warning);
            font-weight: 600;
        }

        .priority-basse {
            color: var(--success);
            font-weight: 600;
        }

        /* Responsive workflow */
        @media (max-width: 768px) {
            .workflow-steps {
                flex-direction: column;
            }
            
            .step-card::after {
                content: '‚Üì';
                right: 50%;
                bottom: -1rem;
                top: auto;
                transform: translateX(50%);
            }
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--sos-light-blue);
        }

        th {
            padding: 1rem 1.25rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--sos-light-blue);
            color: var(--text-secondary);
        }

        tr:hover {
            background: rgba(0, 171, 236, 0.03);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-screen {
                padding: 1rem;
            }
            
            .main-header {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Decorative Elements -->
    <div class="deco-bubble bubble-1"></div>
    <div class="deco-bubble bubble-2"></div>
    <div class="deco-bubble bubble-3"></div>
    <div class="deco-j j-shape"></div>
    <div class="deco-lines">
        <div class="deco-line long"></div>
        <div class="deco-line medium"></div>
        <div class="deco-line short"></div>
    </div>

    <!-- ========================================
         PAGE D'ACCUEIL (LANDING PAGE)
         ======================================== -->
    <div id="landingScreen" class="landing-screen">
        <header class="landing-header">
            <div class="header-content" style="max-width: 1400px; margin: 0 auto;">
                <div class="header-left">
                    <div class="sos-logo">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="10" width="80" height="80" rx="18" fill="#4A6FA5"/>
                            <circle cx="32" cy="30" r="7" fill="white"/>
                            <path d="M25 40 L25 60 L30 60 L30 46 L35 46 L35 60 L40 60 L40 40 Q40 38 32.5 38 Q25 38 25 40" fill="white"/>
                            <line x1="25" y1="44" x2="18" y2="50" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="40" y1="44" x2="47" y2="48" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <circle cx="68" cy="30" r="7" fill="white"/>
                            <path d="M60 40 L60 60 L65 60 L65 46 L70 46 L70 60 L75 60 L75 40 Q75 38 67.5 38 Q60 38 60 40" fill="white"/>
                            <ellipse cx="50" cy="34" rx="4" ry="9" fill="white"/>
                            <line x1="50" y1="42" x2="50" y2="65" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            <line x1="18" y1="76" x2="82" y2="76" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1>Hack for Hope</h1>
                        <div class="sos-slogan">
                            <span class="we-can">WE CAN,</span>
                            <span class="we-do">WE DO,</span>
                            <span class="with-text">WITH</span>
                            <span class="love-text">love</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="landing-content">
            <div class="landing-hero">
                <h1>Plateforme de Protection de l'Enfance</h1>
                <p>SOS Villages d'Enfants Tunisie vous pr√©sente une solution innovante pour la protection et le bien-√™tre des enfants. Ensemble, nous assurons leur s√©curit√© avec amour et professionnalisme.</p>
                <button onclick="goToLogin()" class="btn btn-primary">Acc√©der √† la plateforme</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         MODAL PROFIL UTILISATEUR
         ======================================== -->
    <div id="profileModal" class="profile-modal-overlay">
        <div class="profile-modal">
            <h2>üë§ Mon Profil</h2>
            
            <div class="profile-section">
                <h3>Photo de profil</h3>
                <div style="text-align: center;">
                    <div id="profileAvatarDisplay" class="avatar-placeholder-large">
                        üë§
                    </div>
                    <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="handleProfilePhotoUpload(event)">
                    <div class="avatar-actions">
                        <button onclick="document.getElementById('profilePhotoInput').click()" class="btn btn-secondary">üì∑ Ajouter/Modifier</button>
                        <button onclick="deleteProfilePhoto()" class="btn btn-secondary" style="border-color: var(--sos-pink); color: var(--sos-pink);">üóëÔ∏è Supprimer</button>
                    </div>
                </div>
            </div>
            
            <div class="profile-section">
                <h3>Informations personnelles</h3>
                <div class="form-group">
                    <label class="form-label">Nom</label>
                    <input type="text" id="profileNom" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Pr√©nom</label>
                    <input type="text" id="profilePrenom" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="profileEmail" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">R√¥le</label>
                    <input type="text" id="profileRole" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Identifiant</label>
                    <input type="text" id="profileIdentifiant" class="form-input" readonly>
                </div>
            </div>
            
            <div class="profile-section">
                <h3>Changer mon mot de passe</h3>
                <form onsubmit="handleChangePassword(event)">
                    <div class="form-group">
                        <label class="form-label required">Mot de passe actuel</label>
                        <input type="password" id="currentPassword" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Nouveau mot de passe</label>
                        <input type="password" id="newPassword" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Confirmer le nouveau mot de passe</label>
                        <input type="password" id="confirmPassword" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: auto;">Changer le mot de passe</button>
                </form>
            </div>
            
            <div class="btn-group" style="margin-top: 2rem;">
                <button onclick="closeProfileModal()" class="btn btn-secondary">Fermer</button>
                <button onclick="logout()" class="btn btn-primary" style="background: var(--sos-pink);">Se d√©connecter</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         √âTAPE 1: LOGIN SCREEN
         ======================================== -->
    <div id="loginScreen" class="login-screen" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <!-- SOS Official Logo -->
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background -->
                        <rect x="10" y="10" width="80" height="80" rx="18" fill="#4A6FA5"/>
                        
                        <!-- Left Child -->
                        <circle cx="32" cy="30" r="7" fill="white"/>
                        <path d="M25 40 L25 60 L30 60 L30 46 L35 46 L35 60 L40 60 L40 40 Q40 38 32.5 38 Q25 38 25 40" fill="white"/>
                        <line x1="25" y1="44" x2="18" y2="50" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="40" y1="44" x2="47" y2="48" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="28" y1="60" x2="24" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="37" y1="60" x2="41" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        
                        <!-- Right Child -->
                        <circle cx="68" cy="30" r="7" fill="white"/>
                        <path d="M60 40 L60 60 L65 60 L65 46 L70 46 L70 60 L75 60 L75 40 Q75 38 67.5 38 Q60 38 60 40" fill="white"/>
                        <line x1="60" y1="44" x2="53" y2="48" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="75" y1="44" x2="82" y2="50" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="63" y1="60" x2="59" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="72" y1="60" x2="76" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                        
                        <!-- Plant -->
                        <line x1="50" y1="42" x2="50" y2="65" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        <ellipse cx="50" cy="34" rx="4" ry="9" fill="white"/>
                        <ellipse cx="43" cy="50" rx="3" ry="7" fill="white" transform="rotate(-30 43 50)"/>
                        <ellipse cx="57" cy="50" rx="3" ry="7" fill="white" transform="rotate(30 57 50)"/>
                        
                        <!-- Ground -->
                        <line x1="18" y1="76" x2="82" y2="76" stroke="white" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                </div>
                <h1>Hack for Hope</h1>
                <p class="subtitle">Plateforme de Protection de l'Enfance<br>SOS Villages d'Enfants Tunisie</p>
                <div class="sos-slogan" style="justify-content: center; margin-top: 0.75rem;">
                    <span class="we-can">WE CAN,</span>
                    <span class="we-do">WE DO,</span>
                    <span class="with-text">WITH</span>
                    <span class="love-text">love</span>
                </div>
            </div>
            
            <div class="login-body">
                <div class="role-selection">
                    <h3>S√©lectionnez votre r√¥le</h3>
                    <div class="role-cards">
                        <div class="role-card" onclick="selectRole('mere')">
                            <div class="role-icon">ÔøΩ</div>
                            <div class="role-info">
                                <h4>M√®re SOS</h4>
                                <p>Responsable de maison d'enfants</p>
                            </div>
                        </div>
                        <div class="role-card" onclick="selectRole('tante')">
                            <div class="role-icon">ÔøΩ‚Äçü¶±</div>
                            <div class="role-info">
                                <h4>Tante SOS</h4>
                                <p>Assistante maternelle</p>
                            </div>
                        </div>
                        <div class="role-card" onclick="selectRole('psychologue')">
                            <div class="role-icon">üß†</div>
                            <div class="role-info">
                                <h4>Psychologue</h4>
                                <p>Sp√©cialiste en protection de l'enfance</p>
                            </div>
                        </div>
                        <div class="role-card" onclick="selectRole('educateur')">
                            <div class="role-icon">üìö</div>
                            <div class="role-info">
                                <h4>√âducateur-√âducatrice</h4>
                                <p>Accompagnement √©ducatif</p>
                            </div>
                        </div>
                        <div class="role-card" onclick="selectRole('directeur')">
                            <div class="role-icon">üëî</div>
                            <div class="role-info">
                                <h4>Directeur Responsable</h4>
                                <p>Direction du village</p>
                            </div>
                        </div>
                        <div class="role-card" onclick="selectRole('admin')">
                            <div class="role-icon">‚öôÔ∏è</div>
                            <div class="role-info">
                                <h4>Administrateur</h4>
                                <p>Gestion des comptes et param√®tres</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Identifiant</label>
                        <input type="text" class="form-input" placeholder="Votre identifiant" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mot de passe</label>
                        <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Se connecter</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================
         √âTAPE 2+: MAIN APPLICATION
         ======================================== -->
    <div id="appContainer" class="app-container">
        <header class="main-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="sos-logo">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="10" y="10" width="80" height="80" rx="18" fill="#4A6FA5"/>
                            <circle cx="32" cy="30" r="7" fill="white"/>
                            <path d="M25 40 L25 60 L30 60 L30 46 L35 46 L35 60 L40 60 L40 40 Q40 38 32.5 38 Q25 38 25 40" fill="white"/>
                            <line x1="25" y1="44" x2="18" y2="50" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="40" y1="44" x2="47" y2="48" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="28" y1="60" x2="24" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="37" y1="60" x2="41" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <circle cx="68" cy="30" r="7" fill="white"/>
                            <path d="M60 40 L60 60 L65 60 L65 46 L70 46 L70 60 L75 60 L75 40 Q75 38 67.5 38 Q60 38 60 40" fill="white"/>
                            <line x1="60" y1="44" x2="53" y2="48" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="75" y1="44" x2="82" y2="50" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="63" y1="60" x2="59" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="72" y1="60" x2="76" y2="74" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                            <ellipse cx="50" cy="34" rx="4" ry="9" fill="white"/>
                            <line x1="50" y1="42" x2="50" y2="65" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            <ellipse cx="43" cy="50" rx="3" ry="7" fill="white" transform="rotate(-30 43 50)"/>
                            <ellipse cx="57" cy="50" rx="3" ry="7" fill="white" transform="rotate(30 57 50)"/>
                            <line x1="18" y1="76" x2="82" y2="76" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1>Hack for Hope</h1>
                        <div class="sos-slogan">
                            <span class="we-can">WE CAN,</span>
                            <span class="we-do">WE DO,</span>
                            <span class="with-text">WITH</span>
                            <span class="love-text">love</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div id="mainContent" style="max-width: 1400px; margin: 2rem auto; padding: 0 2rem;">
            <div style="background: white; border-radius: 20px; padding: 3rem; text-align: center; box-shadow: var(--shadow-md);">
                <h2 style="color: var(--sos-dark-blue); margin-bottom: 1rem;">üöß Application en d√©veloppement</h2>
                <p style="color: var(--text-secondary);">Les fonctionnalit√©s seront ajout√©es √©tape par √©tape selon l'ordre √©tabli.</p>
            </div>
        </div>
    </div>

    <script>
        let currentRole = null;
        let currentUser = null;

        // Stockage local des comptes utilisateurs
        let userAccounts = JSON.parse(localStorage.getItem('sos_userAccounts')) || [
            { id: 1, nom: 'Admin', prenom: 'Syst√®me', email: 'admin@sos.tn', role: 'admin', identifiant: 'admin', motDePasse: 'admin123', actif: true, dateCreation: '2026-02-14' }
        ];

        // Stockage des signalements
        let reports = JSON.parse(localStorage.getItem('sos_reports')) || [];

        // Stockage des notifications
        let notifications = JSON.parse(localStorage.getItem('sos_notifications')) || [];

        // Workflow steps definition
        const WORKFLOW_STEPS = [
            { id: 1, name: 'Fiche Initiale', description: 'Signalement re√ßu + Rapport DPE', duration: 1 },
            { id: 2, name: '√âvaluation Compl√®te', description: 'Analyse approfondie du cas', duration: 3 },
            { id: 3, name: 'Plan d\'Action', description: '√âlaboration de la strat√©gie', duration: 2 },
            { id: 4, name: 'Rapport de Suivi', description: 'Suivi document√©', duration: 7 },
            { id: 5, name: 'Rapport Final', description: 'Synth√®se et recommandations', duration: 2 },
            { id: 6, name: 'Avis de Cl√¥ture', description: 'Validation et archivage', duration: 1 }
        ];

        // Status definitions
        const STATUS = {
            EN_ATTENTE: 'en-attente',
            EN_COURS: 'en-cours',
            FAUX: 'faux',
            CLOTURE: 'cloture',
            PRIS_EN_CHARGE: 'pris-en-charge',
            SAUVEGARDE: 'sauvegarde'
        };

        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-card').forEach(card => card.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function handleLogin(e) {
            e.preventDefault();
            if (!currentRole) {
                alert('Veuillez s√©lectionner un r√¥le');
                return;
            }
            
            const identifiant = e.target.querySelector('input[type="text"]').value;
            const motDePasse = e.target.querySelector('input[type="password"]').value;
            
            const user = userAccounts.find(u => u.identifiant === identifiant && u.motDePasse === motDePasse && u.role === currentRole && u.actif);
            
            if (!user) {
                alert('Identifiants incorrects ou compte inactif');
                return;
            }
            
            currentUser = user;
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            loadInterface(currentRole);
            
            // Check for notifications
            checkNotifications();
        }

        function getRoleName(role) {
            const names = {
                'mere': 'M√®re SOS',
                'tante': 'Tante SOS',
                'psychologue': 'Psychologue',
                'educateur': '√âducateur',
                'directeur': 'Directeur Responsable',
                'admin': 'Administrateur'
            };
            return names[role] || 'Utilisateur';
        }

        function logout() {
            currentUser = null;
            currentRole = null;
            closeProfileModal();
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('landingScreen').style.display = 'flex';
            document.querySelectorAll('.role-card').forEach(card => card.classList.remove('active'));
            document.querySelector('form').reset();
        }

        // ========================================
        // NOTIFICATIONS SYSTEM
        // ========================================
        function addNotification(type, title, message, recipientRoles, data = {}) {
            const notification = {
                id: Date.now(),
                type,
                title,
                message,
                recipientRoles,
                data,
                date: new Date().toISOString(),
                read: false
            };
            notifications.push(notification);
            localStorage.setItem('sos_notifications', JSON.stringify(notifications));
        }

        function checkNotifications() {
            const userNotifications = notifications.filter(n => 
                n.recipientRoles.includes(currentUser.role) && !n.read
            );
            
            if (userNotifications.length > 0) {
                showNotification(userNotifications[0]);
            }
        }

        function showNotification(notification) {
            // Mark as read
            notification.read = true;
            localStorage.setItem('sos_notifications', JSON.stringify(notifications));
            
            // Show alert (in real app, this would be a toast/notification UI)
            alert(`üîî ${notification.title}\n\n${notification.message}`);
        }

        // ========================================
        // REPORTS MANAGEMENT
        // ========================================
        function saveReport(report) {
            reports.push(report);
            localStorage.setItem('sos_reports', JSON.stringify(reports));
        }

        function updateReport(reportId, updates) {
            const index = reports.findIndex(r => r.id === reportId);
            if (index !== -1) {
                reports[index] = { ...reports[index], ...updates };
                localStorage.setItem('sos_reports', JSON.stringify(reports));
            }
        }

        function getReportById(reportId) {
            return reports.find(r => r.id === reportId);
        }

        function getReportsByDeclarant(declarantId) {
            return reports.filter(r => r.declarantId === declarantId);
        }

        function getReportsByStatus(status) {
            return reports.filter(r => r.status === status);
        }

        function getReportsByVillage(village) {
            return reports.filter(r => r.village === village);
        }

        // ========================================
        // WORKFLOW MANAGEMENT
        // ========================================
        function startWorkflow(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            report.workflow = {
                currentStep: 1,
                steps: WORKFLOW_STEPS.map(step => ({
                    ...step,
                    status: step.id === 1 ? 'in-progress' : 'pending',
                    startDate: step.id === 1 ? new Date().toISOString() : null,
                    endDate: null,
                    documents: [],
                    notes: ''
                })),
                status: 'active'
            };
            report.status = STATUS.EN_COURS;
            
            updateReport(reportId, report);
            
            // Notify Director and National Bureau
            addNotification(
                'workflow-started',
                'Nouveau signalement √† traiter',
                `Le signalement ${report.id} n√©cessite votre attention. La fiche initiale est en cours.`,
                ['directeur', 'admin']
            );
        }

        function advanceWorkflowStep(reportId) {
            const report = getReportById(reportId);
            if (!report || !report.workflow) return;
            
            const currentStepIndex = report.workflow.currentStep - 1;
            const currentStep = report.workflow.steps[currentStepIndex];
            
            // Complete current step
            currentStep.status = 'completed';
            currentStep.endDate = new Date().toISOString();
            
            // Move to next step
            if (currentStepIndex < report.workflow.steps.length - 1) {
                report.workflow.currentStep++;
                const nextStep = report.workflow.steps[currentStepIndex + 1];
                nextStep.status = 'in-progress';
                nextStep.startDate = new Date().toISOString();
                
                // Notify relevant users
                addNotification(
                    'workflow-step',
                    `√âtape ${nextStep.id} : ${nextStep.name}`,
                    `Le signalement ${report.id} passe √† l'√©tape : ${nextStep.name}`,
                    ['psychologue', 'directeur']
                );
            } else {
                // Workflow complete
                report.workflow.status = 'completed';
                report.status = STATUS.CLOTURE;
                
                addNotification(
                    'workflow-complete',
                    'Signalement cl√¥tur√©',
                    `Le signalement ${report.id} a √©t√© cl√¥tur√© avec succ√®s.`,
                    ['directeur', 'psychologue', 'admin']
                );
            }
            
            updateReport(reportId, report);
        }

        function addWorkflowDocument(reportId, stepId, document) {
            const report = getReportById(reportId);
            if (!report || !report.workflow) return;
            
            const step = report.workflow.steps.find(s => s.id === stepId);
            if (step) {
                step.documents.push({
                    id: Date.now(),
                    name: document.name,
                    type: document.type,
                    date: new Date().toISOString(),
                    data: document.data || null
                });
                updateReport(reportId, report);
            }
        }

        // ========================================
        // CLASSIFICATION & DECISIONS
        // ========================================
        function classifyReport(reportId, classification, notes = '') {
            const report = getReportById(reportId);
            if (!report) return;
            
            report.classification = classification;
            report.classificationNotes = notes;
            report.classifiedBy = currentUser.id;
            report.classifiedDate = new Date().toISOString();
            
            switch (classification) {
                case 'prise-en-charge':
                    report.status = STATUS.PRIS_EN_CHARGE;
                    startWorkflow(reportId);
                    break;
                case 'sauvegarde':
                    report.status = STATUS.SAUVEGARDE;
                    break;
                case 'faux':
                    report.status = STATUS.FAUX;
                    break;
            }
            
            updateReport(reportId, report);
            
            addNotification(
                'classification',
                'Signalement classifi√©',
                `Le signalement ${reportId} a √©t√© classifi√© comme : ${classification}`,
                ['directeur', 'psychologue']
            );
        }

        function makeDecision(reportId, decisionType, decisionDetails) {
            const report = getReportById(reportId);
            if (!report) return;
            
            report.decision = {
                type: decisionType,
                details: decisionDetails,
                madeBy: currentUser.id,
                date: new Date().toISOString()
            };
            
            updateReport(reportId, report);
            
            addNotification(
                'decision',
                'D√©cision prise',
                `Une d√©cision a √©t√© prise pour le signalement ${reportId}`,
                ['psychologue', 'directeur']
            );
        }

        // ========================================
        // ARCHIVING
        // ========================================
        function archiveReport(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            report.archived = true;
            report.archiveDate = new Date().toISOString();
            report.archivedBy = currentUser.id;
            
            updateReport(reportId, report);
            
            addNotification(
                'archive',
                'Signalement archiv√©',
                `Le signalement ${reportId} a √©t√© archiv√© avec succ√®s.`,
                ['admin', 'directeur']
            );
        }

        function getArchivedReports() {
            return reports.filter(r => r.archived);
        }

        function loadInterface(role) {
            const content = document.getElementById('mainContent');
            
            // Ajouter le header utilisateur
            const header = document.querySelector('.header-content');
            const userInfo = document.createElement('div');
            userInfo.className = 'user-info';
            userInfo.style.cssText = 'display: flex; align-items: center; gap: 1rem;';
            userInfo.innerHTML = `
                <span style="color: var(--text-secondary);">${currentUser.prenom} ${currentUser.nom}</span>
                <button onclick="logout()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">D√©connexion</button>
            `;
            // Supprimer ancien user-info si existe
            const oldUserInfo = header.querySelector('.user-info');
            if (oldUserInfo) oldUserInfo.remove();
            header.appendChild(userInfo);
            
            if (role === 'admin') {
                content.innerHTML = generateAdminInterface();
            } else if (['mere', 'tante', 'educateur'].includes(role)) {
                content.innerHTML = generateDeclarantInterface();
            } else if (role === 'psychologue') {
                content.innerHTML = generatePsychologueInterface();
            } else if (role === 'directeur') {
                content.innerHTML = generateDirecteurInterface();
            }
        }

        // ========================================
        // √âTAPE 3: NIVEAU 1 - D√âCLARANT
        // ========================================
        function generateLevel1Interface() {
            return `
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button class="nav-btn active" onclick="showDeclarantTab('nouveau')">Nouveau Signalement</button>
                    <button class="nav-btn" onclick="showDeclarantTab('mes-signalements')">Mes Signalements</button>
                </div>
                
                <div id="declarant-nouveau" class="declarant-tab">
                    ${generateNewReportForm()}
                </div>
                
                <div id="declarant-mes-signalements" class="declarant-tab" style="display: none;">
                    ${generateMyReportsTable()}
                </div>
            `;
        }

        function generateNewReportForm() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nouveau Signalement</h2>
                        <p class="card-subtitle">Les champs marqu√©s d'un ast√©risque (*) sont obligatoires</p>
                    </div>
                    <form onsubmit="handleSubmitReport(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">Type d'incident</label>
                                <select class="form-select" name="type" required>
                                    <option value="">S√©lectionner le type</option>
                                    <option value="sante">Sant√©</option>
                                    <option value="comportement">Comportement</option>
                                    <option value="violence">Violence</option>
                                    <option value="conflit">Conflit</option>
                                    <option value="maltraitance">Maltraitance</option>
                                    <option value="autre">Autre</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Niveau d'urgence</label>
                                <select class="form-select" name="urgence" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="urgent">üî¥ Urgent</option>
                                    <option value="moyen">üü° Moyen</option>
                                    <option value="bas">üü¢ Bas</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Village (Programme)</label>
                                <select class="form-select" name="village" required>
                                    <option value="">S√©lectionner un village</option>
                                    <option value="tunis">Village Tunis</option>
                                    <option value="sousse">Village Sousse</option>
                                    <option value="sfax">Village Sfax</option>
                                    <option value="bizerte">Village Bizerte</option>
                                    <option value="kairouan">Village Kairouan</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Signalement anonyme</label>
                                <select class="form-select" name="anonyme">
                                    <option value="non">Non</option>
                                    <option value="oui">Oui</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Nom de l'enfant</label>
                                <input type="text" class="form-input" name="enfant" placeholder="Pr√©nom et nom de l'enfant" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Nom de l'abuseur (si applicable)</label>
                                <input type="text" class="form-input" name="abuseur" placeholder="Pr√©nom et nom">
                            </div>
                            
                            <div class="form-group full-width">
                                <label class="form-label required">Description d√©taill√©e</label>
                                <textarea class="form-textarea" name="description" placeholder="D√©crivez l'incident de mani√®re d√©taill√©e et objective..." required></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label class="form-label">Pi√®ces jointes</label>
                                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                                    <input type="file" id="fileInput" style="display: none;" multiple accept="image/*,audio/*,video/*">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--sos-blue)" stroke-width="2" style="margin-bottom: 0.5rem;">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                                    </svg>
                                    <div style="font-weight: 600; color: var(--sos-dark-blue);">Glissez-d√©posez vos fichiers ici</div>
                                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">Photos, audio, vid√©o (Max 10MB par fichier)</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button type="reset" class="btn btn-secondary">Annuler</button>
                            <button type="submit" class="btn btn-primary">Soumettre le signalement</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateMyReportsTable() {
            const myReports = getReportsByDeclarant(currentUser.id);
            
            if (myReports.length === 0) {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Mes Signalements</h2>
                            <p class="card-subtitle">Historique de vos signalements</p>
                        </div>
                        <div style="text-align: center; padding: 3rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
                            <p style="color: var(--text-secondary);">Vous n'avez pas encore de signalements.</p>
                            <p style="color: var(--text-muted); font-size: 0.9rem;">Cr√©ez votre premier signalement en cliquant sur "Nouveau Signalement".</p>
                        </div>
                    </div>
                `;
            }
            
            const getStatusBadge = (status) => {
                const statusMap = {
                    [STATUS.EN_ATTENTE]: { class: 'badge-en-traitement', label: 'En attente' },
                    [STATUS.EN_COURS]: { class: 'badge-en-traitement', label: 'En cours' },
                    [STATUS.PRIS_EN_CHARGE]: { class: 'badge-cl√¥tur√©', label: 'Pris en charge' },
                    [STATUS.SAUVEGARDE]: { class: 'badge-cl√¥tur√©', label: 'Sauvegard√©' },
                    [STATUS.FAUX]: { class: 'badge-urgent', label: 'Faux signalement' },
                    [STATUS.CLOTURE]: { class: 'badge-cl√¥tur√©', label: 'Cl√¥tur√©' }
                };
                const s = statusMap[status] || { class: 'badge-en-traitement', label: status };
                return `<span class="badge ${s.class}">${s.label}</span>`;
            };
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Mes Signalements (${myReports.length})</h2>
                        <p class="card-subtitle">Historique de vos signalements</p>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Enfant</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${myReports.map(r => `
                                    <tr>
                                        <td><strong>${r.id}</strong></td>
                                        <td>${new Date(r.dateCreation).toLocaleDateString('fr-FR')}</td>
                                        <td>${r.type}</td>
                                        <td>${r.enfant}</td>
                                        <td>${getStatusBadge(r.status)}</td>
                                        <td>
                                            <button onclick="viewReportDetails('${r.id}')" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                                                üëÅÔ∏è Voir
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function viewReportDetails(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            const statusLabels = {
                [STATUS.EN_ATTENTE]: 'En attente',
                [STATUS.EN_COURS]: 'En cours de traitement',
                [STATUS.PRIS_EN_CHARGE]: 'Pris en charge',
                [STATUS.SAUVEGARDE]: 'Sauvegard√©',
                [STATUS.FAUX]: 'Faux signalement',
                [STATUS.CLOTURE]: 'Cl√¥tur√©'
            };
            
            alert(`üìã D√©tails du Signalement ${report.id}\n\n` +
                  `Type: ${report.type}\n` +
                  `Urgence: ${report.urgence}\n` +
                  `Village: ${report.village}\n` +
                  `Enfant: ${report.enfant}\n` +
                  `Abuseur: ${report.abuseur || 'Non sp√©cifi√©'}\n` +
                  `Statut: ${statusLabels[report.status] || report.status}\n` +
                  `Date: ${new Date(report.dateCreation).toLocaleString('fr-FR')}\n\n` +
                  `Description:\n${report.description}`);
        }

        function showDeclarantTab(tab) {
            document.querySelectorAll('.declarant-tab').forEach(t => t.style.display = 'none');
            document.getElementById(`declarant-${tab}`).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            // Refresh reports table when switching to it
            if (tab === 'mes-signalements') {
                document.getElementById('declarant-mes-signalements').innerHTML = generateMyReportsTable();
            }
        }

        function handleSubmitReport(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const report = Object.fromEntries(formData);
            console.log('Signalement soumis:', report);
            alert('Signalement soumis avec succ√®s ! R√©f√©rence: #2026-' + Math.floor(Math.random() * 100 + 90));
            e.target.reset();
        }

        // ========================================
        // √âTAPE 4: NIVEAU 2 - ANALYSE & TRAITEMENT
        // ========================================
        function generateLevel2Interface() {
            // Get real stats
            const pendingReports = getReportsByStatus(STATUS.EN_ATTENTE);
            const urgentReports = reports.filter(r => r.urgence === 'urgent' && !r.archived);
            const inProgressReports = getReportsByStatus(STATUS.EN_COURS);
            const closedThisMonth = reports.filter(r => {
                if (r.status !== STATUS.CLOTURE) return false;
                const date = new Date(r.dateCreation);
                const now = new Date();
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            });
            
            return `
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button class="nav-btn active" onclick="showAnalystTab('dashboard')">Dashboard</button>
                    <button class="nav-btn" onclick="showAnalystTab('a-traiter')">√Ä Traiter (${pendingReports.length})</button>
                    <button class="nav-btn" onclick="showAnalystTab('workflow')">Workflow</button>
                </div>
                
                <div id="analyst-dashboard" class="analyst-tab">
                    ${generateAnalystDashboard(pendingReports.length, urgentReports.length, closedThisMonth.length)}
                </div>
                
                <div id="analyst-a-traiter" class="analyst-tab" style="display: none;">
                    ${generateReportsToProcessTable()}
                </div>
                
                <div id="analyst-workflow" class="analyst-tab" style="display: none;">
                    ${generateWorkflowInterface()}
                </div>
            `;
        }

        function generateAnalystDashboard(pendingCount, urgentCount, closedCount) {
            // Calculate village stats
            const villages = ['tunis', 'sousse', 'sfax', 'bizerte', 'kairouan'];
            const villageStats = villages.map(v => {
                const vReports = getReportsByVillage(v);
                const active = vReports.filter(r => !r.archived).length;
                const inProgress = vReports.filter(r => r.status === STATUS.EN_COURS).length;
                const urgent = vReports.filter(r => r.urgence === 'urgent' && !r.archived).length;
                const closed = vReports.filter(r => r.status === STATUS.CLOTURE).length;
                return { name: `Village ${v.charAt(0).toUpperCase() + v.slice(1)}`, active, inProgress, urgent, closed };
            });
            
            return `
                <div class="stats-grid">
                    <div class="stat-card info">
                        <div class="stat-number">${pendingCount}</div>
                        <div class="stat-label">Signalements en attente</div>
                    </div>
                    <div class="stat-card urgent">
                        <div class="stat-number" style="color: var(--sos-pink);">${urgentCount}</div>
                        <div class="stat-label">Cas urgents</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-number" style="color: var(--success);">${closedCount}</div>
                        <div class="stat-label">Cas trait√©s ce mois</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-number">${reports.filter(r => !r.archived).length}</div>
                        <div class="stat-label">Cas actifs</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Vue globale par village</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Village</th>
                                    <th>Actifs</th>
                                    <th>En traitement</th>
                                    <th>Urgents</th>
                                    <th>Cl√¥tur√©s</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${villageStats.map(v => `
                                    <tr>
                                        <td><strong>${v.name}</strong></td>
                                        <td>${v.active}</td>
                                        <td>${v.inProgress}</td>
                                        <td style="color: ${v.urgent > 0 ? 'var(--sos-pink)' : 'inherit'}; font-weight: ${v.urgent > 0 ? '600' : 'normal'};">${v.urgent}</td>
                                        <td>${v.closed}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateReportsToProcessTable() {
            const pendingReports = reports.filter(r => r.status === STATUS.EN_ATTENTE && !r.archived);
            
            if (pendingReports.length === 0) {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Signalements √† traiter</h2>
                            <p class="card-subtitle">Aucun signalement en attente</p>
                        </div>
                        <div style="text-align: center; padding: 3rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                            <p style="color: var(--text-secondary);">Tous les signalements ont √©t√© trait√©s !</p>
                        </div>
                    </div>
                `;
            }
            
            const priorityLabels = {
                'urgent': { class: 'priority-√©lev√©e', label: 'üî¥ Urgent' },
                'moyen': { class: 'priority-moyenne', label: 'üü° Moyen' },
                'bas': { class: 'priority-basse', label: 'üü¢ Bas' }
            };
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Signalements √† traiter (${pendingReports.length})</h2>
                        <p class="card-subtitle">Liste des cas n√©cessitant une classification</p>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Date</th>
                                    <th>Village</th>
                                    <th>Type</th>
                                    <th>Priorit√©</th>
                                    <th>D√©clarant</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pendingReports.map(r => {
                                    const priority = priorityLabels[r.urgence] || priorityLabels['moyen'];
                                    return `
                                    <tr>
                                        <td><strong>${r.id}</strong></td>
                                        <td>${new Date(r.dateCreation).toLocaleDateString('fr-FR')}</td>
                                        <td>${r.village}</td>
                                        <td>${r.type}</td>
                                        <td><span class="${priority.class}">${priority.label}</span></td>
                                        <td>${r.anonyme === 'oui' ? 'Anonyme' : r.declarantName}</td>
                                        <td>
                                            <button onclick="openClassificationModal('${r.id}')" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                                                üîç Classifier
                                            </button>
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function openClassificationModal(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            const classification = prompt(
                `Classifier le signalement ${reportId}\n\n` +
                `Enfant: ${report.enfant}\n` +
                `Type: ${report.type}\n` +
                `Description: ${report.description.substring(0, 100)}...\n\n` +
                `Choisissez:\n` +
                `1 - Prise en charge imm√©diate\n` +
                `2 - Sauvegarde pour suivi\n` +
                `3 - Faux signalement\n\n` +
                `Entrez 1, 2 ou 3:`
            );
            
            if (!classification) return;
            
            const notes = prompt('Notes de classification (optionnel):') || '';
            
            switch(classification) {
                case '1':
                    classifyReport(reportId, 'prise-en-charge', notes);
                    alert('Signalement classifi√© : Prise en charge imm√©diate\n\nLe workflow de traitement a √©t√© initi√©.');
                    break;
                case '2':
                    classifyReport(reportId, 'sauvegarde', notes);
                    alert('Signalement classifi√© : Sauvegarde pour suivi');
                    break;
                case '3':
                    classifyReport(reportId, 'faux', notes);
                    alert('Signalement classifi√© : Faux signalement');
                    break;
                default:
                    alert('Classification annul√©e');
                    return;
            }
            
            // Refresh the table
            document.getElementById('analyst-a-traiter').innerHTML = generateReportsToProcessTable();
            document.getElementById('analyst-dashboard').innerHTML = generateAnalystDashboard(
                getReportsByStatus(STATUS.EN_ATTENTE).length,
                reports.filter(r => r.urgence === 'urgent' && !r.archived).length,
                reports.filter(r => r.status === STATUS.CLOTURE).length
            );
        }

        function generateWorkflowInterface() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Processus de Traitement - Workflow SOS</h2>
                        <p class="card-subtitle">Les 6 √©tapes obligatoires pour chaque signalement</p>
                    </div>
                    <div class="workflow-container">
                        <div class="workflow-steps">
                            <div class="step-card">
                                <div class="step-number">1</div>
                                <div class="step-title">Fiche Initiale</div>
                                <div class="step-desc">Signalement re√ßu + Rapport DPE envoy√© au Directeur et Bureau National</div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">2</div>
                                <div class="step-title">√âvaluation Compl√®te</div>
                                <div class="step-desc">Analyse approfondie du cas par l'√©quipe psychosociale</div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">3</div>
                                <div class="step-title">Plan d'Action</div>
                                <div class="step-desc">√âlaboration de la strat√©gie d'intervention</div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">4</div>
                                <div class="step-title">Rapport de Suivi</div>
                                <div class="step-desc">Suivi document√© de l'√©volution</div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">5</div>
                                <div class="step-title">Rapport Final</div>
                                <div class="step-desc">Synth√®se et recommandations</div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">6</div>
                                <div class="step-title">Avis de Cl√¥ture</div>
                                <div class="step-desc">Validation finale et archivage</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Classification du signalement</h2>
                        <p class="card-subtitle">√âvaluation et d√©cision de classement</p>
                    </div>
                    <form onsubmit="handleClassification(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">R√©f√©rence</label>
                                <input type="text" class="form-input" placeholder="Ex: #2026-089" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">D√©cision de classification</label>
                                <select class="form-select" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="prise-en-charge">‚úÖ Prise en charge imm√©diate</option>
                                    <option value="sauvegarde">üíæ Sauvegarde pour suivi</option>
                                    <option value="faux">‚ùå Faux signalement</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label required">Rapport confidentiel</label>
                                <textarea class="form-textarea" placeholder="R√©digez votre analyse professionnelle..." required></textarea>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary">Sauvegarder brouillon</button>
                            <button type="button" class="btn btn-pink">Demander avis sup√©rieur</button>
                            <button type="submit" class="btn btn-primary">Valider et transmettre</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function showAnalystTab(tab) {
            document.querySelectorAll('.analyst-tab').forEach(t => t.style.display = 'none');
            document.getElementById(`analyst-${tab}`).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleClassification(e) {
            e.preventDefault();
            alert('Classification soumise avec succ√®s !');
        }

        // ========================================
        // √âTAPE 5: NIVEAU 3 - GOUVERNANCE (placeholder)
        // ========================================
        function generateLevel3Interface() {
            const pendingDecisions = reports.filter(r => 
                (r.status === STATUS.PRIS_EN_CHARGE || r.status === STATUS.EN_COURS) && 
                !r.archived && 
                (!r.decision || !r.decision.type)
            );
            
            const archivedCount = getArchivedReports().length;
            
            return `
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button class="nav-btn active" onclick="showGovernanceTab('vue-globale')">Vue Globale</button>
                    <button class="nav-btn" onclick="showGovernanceTab('decisions')">D√©cisions (${pendingDecisions.length})</button>
                    <button class="nav-btn" onclick="showGovernanceTab('archives')">Archives (${archivedCount})</button>
                </div>
                <div id="governance-vue-globale" class="governance-tab">
                    ${generateGovernanceDashboard()}
                </div>
                <div id="governance-decisions" class="governance-tab" style="display: none;">
                    ${generateDecisionsTable()}
                </div>
                <div id="governance-archives" class="governance-tab" style="display: none;">
                    ${generateArchivesTable()}
                </div>
            `;
        }

        function generateGovernanceDashboard() {
            // Calculate real stats
            const totalReports = reports.length;
            const activeReports = reports.filter(r => !r.archived).length;
            const closedThisMonth = reports.filter(r => {
                if (r.status !== STATUS.CLOTURE) return false;
                const date = new Date(r.dateCreation);
                const now = new Date();
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            }).length;
            
            const avgProcessingTime = calculateAverageProcessingTime();
            const resolutionRate = totalReports > 0 
                ? Math.round((reports.filter(r => r.status === STATUS.CLOTURE).length / totalReports) * 100) 
                : 0;
            
            // Village stats
            const villages = ['tunis', 'sousse', 'sfax', 'bizerte', 'kairouan'];
            const villageStats = villages.map(v => {
                const vReports = getReportsByVillage(v).filter(r => !r.archived);
                return {
                    name: `Village ${v.charAt(0).toUpperCase() + v.slice(1)}`,
                    count: vReports.length,
                    urgent: vReports.filter(r => r.urgence === 'urgent').length
                };
            }).filter(v => v.count > 0);
            
            return `
                <div class="stats-grid">
                    <div class="stat-card info">
                        <div class="stat-number">${totalReports}</div>
                        <div class="stat-label">Total signalements</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-number" style="color: var(--warning);">${avgProcessingTime}j</div>
                        <div class="stat-label">Temps moyen traitement</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-number" style="color: var(--success);">${resolutionRate}%</div>
                        <div class="stat-label">Taux de r√©solution</div>
                    </div>
                    <div class="stat-card urgent">
                        <div class="stat-number" style="color: var(--sos-pink);">${activeReports}</div>
                        <div class="stat-label">Cas actifs</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Vue globale des villages</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Village</th>
                                    <th>Signalements</th>
                                    <th>Urgents</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${villageStats.length > 0 ? villageStats.map(v => `
                                    <tr>
                                        <td><strong>${v.name}</strong></td>
                                        <td>${v.count}</td>
                                        <td style="color: ${v.urgent > 0 ? 'var(--sos-pink)' : 'inherit'}; font-weight: ${v.urgent > 0 ? '600' : 'normal'};">${v.urgent}</td>
                                        <td>
                                            <button onclick="viewVillageReports('${v.name.toLowerCase().replace('village ', '')}')" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                                                üëÅÔ∏è Voir
                                            </button>
                                        </td>
                                    </tr>
                                `).join('') : '<tr><td colspan="4" style="text-align: center;">Aucun signalement</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateDecisionsTable() {
            const pendingDecisions = reports.filter(r => 
                (r.status === STATUS.PRIS_EN_CHARGE || r.status === STATUS.EN_COURS) && 
                !r.archived && 
                (!r.decision || !r.decision.type)
            );
            
            if (pendingDecisions.length === 0) {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Prise de d√©cision</h2>
                            <p class="card-subtitle">Aucune d√©cision en attente</p>
                        </div>
                        <div style="text-align: center; padding: 3rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                            <p style="color: var(--text-secondary);">Toutes les d√©cisions ont √©t√© prises !</p>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Prise de d√©cision (${pendingDecisions.length})</h2>
                        <p class="card-subtitle">Signalements n√©cessitant une d√©cision formelle</p>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Date</th>
                                    <th>Village</th>
                                    <th>Enfant</th>
                                    <th>Type</th>
                                    <th>Statut Workflow</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pendingDecisions.map(r => `
                                    <tr>
                                        <td><strong>${r.id}</strong></td>
                                        <td>${new Date(r.dateCreation).toLocaleDateString('fr-FR')}</td>
                                        <td>${r.village}</td>
                                        <td>${r.enfant}</td>
                                        <td>${r.type}</td>
                                        <td>${r.workflow ? `√âtape ${r.workflow.currentStep}/6` : 'Non d√©marr√©'}</td>
                                        <td>
                                            <button onclick="openDecisionModal('${r.id}')" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-pink); color: white; border: none; border-radius: 6px; cursor: pointer;">
                                                ‚öñÔ∏è D√©cider
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateArchivesTable() {
            const archivedReports = getArchivedReports();
            
            if (archivedReports.length === 0) {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Archives</h2>
                            <p class="card-subtitle">Signalements archiv√©s</p>
                        </div>
                        <div style="text-align: center; padding: 3rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                            <p style="color: var(--text-secondary);">Aucun signalement archiv√©</p>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Archives (${archivedReports.length})</h2>
                        <p class="card-subtitle">Signalements archiv√©s s√©curis√©s</p>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>R√©f√©rence</th>
                                    <th>Archiv√© le</th>
                                    <th>Par</th>
                                    <th>Enfant</th>
                                    <th>D√©cision finale</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${archivedReports.map(r => `
                                    <tr>
                                        <td><strong>${r.id}</strong></td>
                                        <td>${new Date(r.archiveDate).toLocaleDateString('fr-FR')}</td>
                                        <td>${userAccounts.find(u => u.id === r.archivedBy)?.prenom || 'Inconnu'}</td>
                                        <td>${r.enfant}</td>
                                        <td>${r.decision?.type || 'Non sp√©cifi√©e'}</td>
                                        <td>
                                            <button onclick="viewArchivedReport('${r.id}')" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                                                üìÇ Voir
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function calculateAverageProcessingTime() {
            const closedReports = reports.filter(r => r.status === STATUS.CLOTURE && r.workflow);
            if (closedReports.length === 0) return 0;
            
            const totalDays = closedReports.reduce((sum, r) => {
                const start = new Date(r.dateCreation);
                const end = new Date(r.workflow.steps[5].endDate || r.dateCreation);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                return sum + days;
            }, 0);
            
            return Math.round(totalDays / closedReports.length);
        }

        function viewVillageReports(village) {
            const villageReports = getReportsByVillage(village).filter(r => !r.archived);
            alert(`Village ${village.charAt(0).toUpperCase() + village.slice(1)}\n\n` +
                  `Signalements actifs: ${villageReports.length}\n` +
                  `Urgents: ${villageReports.filter(r => r.urgence === 'urgent').length}\n` +
                  `En attente: ${villageReports.filter(r => r.status === STATUS.EN_ATTENTE).length}`);
        }

        function openDecisionModal(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            const decision = prompt(
                `Prise de d√©cision pour ${reportId}\n\n` +
                `Enfant: ${report.enfant}\n` +
                `Type: ${report.type}\n` +
                `Description: ${report.description.substring(0, 100)}...\n\n` +
                `Choisissez la d√©cision:\n` +
                `1 - Prise en charge formelle\n` +
                `2 - Sanction\n` +
                `3 - Suivi renforc√©\n` +
                `4 - Cl√¥turer le dossier\n\n` +
                `Entrez 1, 2, 3 ou 4:`
            );
            
            if (!decision) return;
            
            const details = prompt('D√©tails de la d√©cision:') || '';
            
            let decisionType;
            switch(decision) {
                case '1': decisionType = 'prise-en-charge'; break;
                case '2': decisionType = 'sanction'; break;
                case '3': decisionType = 'suivi'; break;
                case '4': decisionType = 'cloture'; break;
                default: alert('D√©cision annul√©e'); return;
            }
            
            makeDecision(reportId, decisionType, details);
            
            if (decision === '4') {
                archiveReport(reportId);
                alert('D√©cision enregistr√©e : Cl√¥ture et archivage du dossier');
            } else {
                alert(`D√©cision enregistr√©e : ${decisionType}`);
            }
            
            // Refresh tables
            document.getElementById('governance-decisions').innerHTML = generateDecisionsTable();
            document.getElementById('governance-archives').innerHTML = generateArchivesTable();
        }

        function viewArchivedReport(reportId) {
            const report = getReportById(reportId);
            if (!report) return;
            
            alert(`üìÅ Dossier Archiv√© ${report.id}\n\n` +
                  `Enfant: ${report.enfant}\n` +
                  `Type: ${report.type}\n` +
                  `D√©cision: ${report.decision?.type || 'Non sp√©cifi√©e'}\n` +
                  `D√©tails: ${report.decision?.details || 'Aucun'}\n` +
                  `Archiv√© le: ${new Date(report.archiveDate).toLocaleDateString('fr-FR')}\n\n` +
                  `Description originale:\n${report.description}`);
        }

        function showGovernanceTab(tab) {
            document.querySelectorAll('.governance-tab').forEach(t => t.style.display = 'none');
            document.getElementById(`governance-${tab}`).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        // ========================================
        // INTERFACE ADMIN - GESTION DES COMPTES
        // ========================================
        function generateAdminInterface() {
            return `
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button class="nav-btn active" onclick="showAdminTab('dashboard')">Dashboard</button>
                    <button class="nav-btn" onclick="showAdminTab('comptes')">Gestion des Comptes</button>
                    <button class="nav-btn" onclick="showAdminTab('nouveau')">Nouveau Compte</button>
                </div>
                
                <div id="admin-dashboard" class="admin-tab">
                    ${generateAdminDashboard()}
                </div>
                
                <div id="admin-comptes" class="admin-tab" style="display: none;">
                    ${generateAccountManagementTable()}
                </div>
                
                <div id="admin-nouveau" class="admin-tab" style="display: none;">
                    ${generateCreateAccountForm()}
                </div>
            `;
        }

        function generateAdminDashboard() {
            const totalAccounts = userAccounts.length;
            const activeAccounts = userAccounts.filter(u => u.actif).length;
            const inactiveAccounts = totalAccounts - activeAccounts;
            const roleCounts = {
                'mere': userAccounts.filter(u => u.role === 'mere').length,
                'tante': userAccounts.filter(u => u.role === 'tante').length,
                'psychologue': userAccounts.filter(u => u.role === 'psychologue').length,
                'educateur': userAccounts.filter(u => u.role === 'educateur').length,
                'directeur': userAccounts.filter(u => u.role === 'directeur').length,
                'admin': userAccounts.filter(u => u.role === 'admin').length
            };
            
            return `
                <div class="stats-grid">
                    <div class="stat-card info">
                        <div class="stat-number">${totalAccounts}</div>
                        <div class="stat-label">Total comptes</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-number" style="color: var(--success);">${activeAccounts}</div>
                        <div class="stat-label">Comptes actifs</div>
                    </div>
                    <div class="stat-card urgent">
                        <div class="stat-number" style="color: var(--sos-pink);">${inactiveAccounts}</div>
                        <div class="stat-label">Comptes inactifs</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">R√©partition par r√¥le</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>R√¥le</th>
                                    <th>Nombre de comptes</th>
                                    <th>Pourcentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>M√®re SOS</strong></td>
                                    <td>${roleCounts.mere}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.mere/totalAccounts*100) : 0}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Tante SOS</strong></td>
                                    <td>${roleCounts.tante}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.tante/totalAccounts*100) : 0}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Psychologue</strong></td>
                                    <td>${roleCounts.psychologue}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.psychologue/totalAccounts*100) : 0}%</td>
                                </tr>
                                <tr>
                                    <td><strong>√âducateur</strong></td>
                                    <td>${roleCounts.educateur}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.educateur/totalAccounts*100) : 0}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Directeur</strong></td>
                                    <td>${roleCounts.directeur}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.directeur/totalAccounts*100) : 0}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Administrateur</strong></td>
                                    <td>${roleCounts.admin}</td>
                                    <td>${totalAccounts > 0 ? Math.round(roleCounts.admin/totalAccounts*100) : 0}%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateAccountManagementTable() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Gestion des Comptes Utilisateurs</h2>
                        <p class="card-subtitle">Cr√©er, modifier ou supprimer des comptes</p>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>R√¥le</th>
                                    <th>Identifiant</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${userAccounts.map(u => `
                                    <tr>
                                        <td><strong>${u.nom}</strong></td>
                                        <td>${u.prenom}</td>
                                        <td>${getRoleName(u.role)}</td>
                                        <td>${u.identifiant}</td>
                                        <td><span class="badge badge-${u.actif ? 'cl√¥tur√©' : 'en-traitement'}">${u.actif ? 'Actif' : 'Inactif'}</span></td>
                                        <td>
                                            <button onclick="editAccount(${u.id})" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; margin-right: 0.5rem;">‚úèÔ∏è Modifier</button>
                                            <button onclick="deleteAccount(${u.id})" class="btn btn-sm" style="padding: 0.4rem 0.8rem; font-size: 0.8rem; background: var(--sos-pink); color: white;">üóëÔ∏è Supprimer</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateCreateAccountForm() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Cr√©er un Nouveau Compte</h2>
                        <p class="card-subtitle">Les champs marqu√©s d'un ast√©risque (*) sont obligatoires</p>
                    </div>
                    <form onsubmit="handleCreateAccount(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">Nom</label>
                                <input type="text" class="form-input" name="nom" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Pr√©nom</label>
                                <input type="text" class="form-input" name="prenom" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" name="email">
                            </div>
                            <div class="form-group">
                                <label class="form-label required">R√¥le</label>
                                <select class="form-select" name="role" required>
                                    <option value="">S√©lectionner un r√¥le</option>
                                    <option value="mere">M√®re SOS</option>
                                    <option value="tante">Tante SOS</option>
                                    <option value="psychologue">Psychologue</option>
                                    <option value="educateur">√âducateur-√âducatrice</option>
                                    <option value="directeur">Directeur Responsable</option>
                                    <option value="admin">Administrateur</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Identifiant</label>
                                <input type="text" class="form-input" name="identifiant" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Mot de passe</label>
                                <input type="password" class="form-input" name="motDePasse" required>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="reset" class="btn btn-secondary">R√©initialiser</button>
                            <button type="submit" class="btn btn-primary">Cr√©er le compte</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function showAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none');
            document.getElementById(`admin-${tab}`).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            // Rafra√Æchir le tableau si on affiche les comptes
            if (tab === 'comptes') {
                document.getElementById('admin-comptes').innerHTML = generateAccountManagementTable();
            }
        }

        function handleCreateAccount(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newAccount = {
                id: Date.now(),
                nom: formData.get('nom'),
                prenom: formData.get('prenom'),
                email: formData.get('email'),
                role: formData.get('role'),
                identifiant: formData.get('identifiant'),
                motDePasse: formData.get('motDePasse'),
                actif: true,
                dateCreation: new Date().toISOString().split('T')[0]
            };
            
            // V√©rifier si l'identifiant existe d√©j√†
            if (userAccounts.find(u => u.identifiant === newAccount.identifiant)) {
                alert('Cet identifiant existe d√©j√†. Veuillez en choisir un autre.');
                return;
            }
            
            userAccounts.push(newAccount);
            localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
            
            alert('Compte cr√©√© avec succ√®s !');
            e.target.reset();
            showAdminTab('comptes');
        }

        function deleteAccount(id) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce compte ?')) return;
            
            // Emp√™cher la suppression de son propre compte
            if (id === currentUser.id) {
                alert('Vous ne pouvez pas supprimer votre propre compte.');
                return;
            }
            
            userAccounts = userAccounts.filter(u => u.id !== id);
            localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
            
            // Rafra√Æchir l'affichage
            document.getElementById('admin-comptes').innerHTML = generateAccountManagementTable();
            alert('Compte supprim√© avec succ√®s.');
        }

        function editAccount(id) {
            const user = userAccounts.find(u => u.id === id);
            if (!user) return;
            
            const newNom = prompt('Nom:', user.nom);
            if (newNom === null) return;
            
            const newPrenom = prompt('Pr√©nom:', user.prenom);
            if (newPrenom === null) return;
            
            const newEmail = prompt('Email:', user.email);
            if (newEmail === null) return;
            
            const roles = ['mere', 'tante', 'psychologue', 'educateur', 'directeur', 'admin'];
            const roleNames = ['M√®re SOS', 'Tante SOS', 'Psychologue', '√âducateur', 'Directeur', 'Administrateur'];
            let rolePrompt = 'R√¥le (0-5):\n';
            roles.forEach((r, i) => rolePrompt += `${i}: ${roleNames[i]}\n`);
            const roleIndex = prompt(rolePrompt + '\nActuel: ' + user.role + ' (' + roleNames[roles.indexOf(user.role)] + ')');
            if (roleIndex === null) return;
            
            const newActif = confirm('Compte actif ?\nOK = Actif, Annuler = Inactif');
            
            const newPassword = prompt('Nouveau mot de passe (laisser vide pour ne pas changer):');
            
            user.nom = newNom || user.nom;
            user.prenom = newPrenom || user.prenom;
            user.email = newEmail || user.email;
            if (roleIndex !== '' && roles[roleIndex]) {
                user.role = roles[roleIndex];
            }
            user.actif = newActif;
            if (newPassword && newPassword.trim() !== '') {
                user.motDePasse = newPassword;
            }
            
            localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
            document.getElementById('admin-comptes').innerHTML = generateAccountManagementTable();
            alert('Compte modifi√© avec succ√®s.');
        }

        // ========================================
        // INTERFACE D√âCLARANT (M√®re, Tante, √âducateur)
        // ========================================
        function generateDeclarantInterface() {
            return generateLevel1Interface();
        }

        // ========================================
        // INTERFACE PSYCHOLOGUE
        // ========================================
        function generatePsychologueInterface() {
            return generateLevel2Interface();
        }

        // ========================================
        // INTERFACE DIRECTEUR
        // ========================================
        function generateDirecteurInterface() {
            return generateLevel3Interface();
        }

        // ========================================
        // LANDING PAGE NAVIGATION
        // ========================================
        function goToLogin() {
            document.getElementById('landingScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
        }

        function goToLanding() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('landingScreen').style.display = 'flex';
            currentUser = null;
            currentRole = null;
        }

        // ========================================
        // PROFILE MANAGEMENT
        // ========================================
        function openProfileModal() {
            if (!currentUser) return;
            
            // Populate profile info
            document.getElementById('profileNom').value = currentUser.nom || '';
            document.getElementById('profilePrenom').value = currentUser.prenom || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profileRole').value = getRoleName(currentUser.role);
            document.getElementById('profileIdentifiant').value = currentUser.identifiant || '';
            
            // Load profile photo if exists
            updateProfileAvatarDisplay();
            
            // Show modal
            document.getElementById('profileModal').classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function updateProfileAvatarDisplay() {
            const display = document.getElementById('profileAvatarDisplay');
            if (currentUser && currentUser.photo) {
                display.innerHTML = `<img src="${currentUser.photo}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else {
                display.innerHTML = 'üë§';
            }
        }

        function handleProfilePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('La photo ne doit pas d√©passer 2MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Update current user photo
                currentUser.photo = e.target.result;
                
                // Update in userAccounts
                const userIndex = userAccounts.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    userAccounts[userIndex].photo = e.target.result;
                    localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
                }
                
                // Update displays
                updateProfileAvatarDisplay();
                updateHeaderAvatar();
                
                alert('Photo de profil mise √† jour avec succ√®s !');
            };
            reader.readAsDataURL(file);
        }

        function deleteProfilePhoto() {
            if (!currentUser || !currentUser.photo) {
                alert('Aucune photo √† supprimer');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer votre photo de profil ?')) return;
            
            // Remove photo from current user
            delete currentUser.photo;
            
            // Update in userAccounts
            const userIndex = userAccounts.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                delete userAccounts[userIndex].photo;
                localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
            }
            
            // Update displays
            updateProfileAvatarDisplay();
            updateHeaderAvatar();
            
            alert('Photo de profil supprim√©e avec succ√®s !');
        }

        function updateHeaderAvatar() {
            const headerInfo = document.querySelector('.user-info');
            if (headerInfo && currentUser) {
                const avatarHtml = currentUser.photo 
                    ? `<img src="${currentUser.photo}" class="profile-avatar" onclick="openProfileModal()">`
                    : `<div class="profile-avatar-placeholder" onclick="openProfileModal()">üë§</div>`;
                
                headerInfo.innerHTML = `
                    ${avatarHtml}
                    <span style="color: var(--text-secondary);">${currentUser.prenom} ${currentUser.nom}</span>
                    <button onclick="logout()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">D√©connexion</button>
                `;
            }
        }

        function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Verify current password
            if (currentPassword !== currentUser.motDePasse) {
                alert('Mot de passe actuel incorrect');
                return;
            }
            
            // Check new password length
            if (newPassword.length < 6) {
                alert('Le nouveau mot de passe doit contenir au moins 6 caract√®res');
                return;
            }
            
            // Check passwords match
            if (newPassword !== confirmPassword) {
                alert('Les nouveaux mots de passe ne correspondent pas');
                return;
            }
            
            // Update password
            currentUser.motDePasse = newPassword;
            
            // Update in userAccounts
            const userIndex = userAccounts.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                userAccounts[userIndex].motDePasse = newPassword;
                localStorage.setItem('sos_userAccounts', JSON.stringify(userAccounts));
            }
            
            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('Mot de passe chang√© avec succ√®s !');
        }

        // Override logout function to return to landing page
        function logout() {
            currentUser = null;
            currentRole = null;
            closeProfileModal();
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('landingScreen').style.display = 'flex';
            document.querySelectorAll('.role-card').forEach(card => card.classList.remove('active'));
            document.querySelector('form').reset();
        }

        // Override loadInterface to add profile avatar in header
        function loadInterface(role) {
            const content = document.getElementById('mainContent');
            
            // Ajouter le header utilisateur avec avatar
            const header = document.querySelector('#appContainer .header-content');
            const userInfo = document.createElement('div');
            userInfo.className = 'user-info';
            userInfo.style.cssText = 'display: flex; align-items: center; gap: 1rem;';
            
            const avatarHtml = currentUser.photo 
                ? `<img src="${currentUser.photo}" class="profile-avatar" onclick="openProfileModal()">`
                : `<div class="profile-avatar-placeholder" onclick="openProfileModal()">üë§</div>`;
            
            userInfo.innerHTML = `
                ${avatarHtml}
                <span style="color: var(--text-secondary);">${currentUser.prenom} ${currentUser.nom}</span>
                <button onclick="logout()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">D√©connexion</button>
            `;
            
            // Supprimer ancien user-info si existe
            const oldUserInfo = header.querySelector('.user-info');
            if (oldUserInfo) oldUserInfo.remove();
            header.appendChild(userInfo);
            
            if (role === 'admin') {
                content.innerHTML = generateAdminInterface();
            } else if (['mere', 'tante', 'educateur'].includes(role)) {
                content.innerHTML = generateDeclarantInterface();
            } else if (role === 'psychologue') {
                content.innerHTML = generatePsychologueInterface();
            } else if (role === 'directeur') {
                content.innerHTML = generateDirecteurInterface();
            }
        }
    </script>
</body>
</html>
